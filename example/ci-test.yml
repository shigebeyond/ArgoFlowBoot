# https://github.com/argoproj/argo-workflows/tree/master/examples/ci.yaml
- flow(ci-test):
    - args:
        revision: cfe12d6
    - vc_templates: # 共享的pvc, 所有任务的容器都会挂载
       - workdir:/go:1Gi # pvc名:挂载路径:空间大小
    - artifacts: # 共享文件(工件), 所有任务都可读写
        code:
            path: /go/src/github.com/golang/example
            git:
              repo: https://github.com/golang/example.git
              revision: "{{inputs.parameters.revision}}"
    - templates:
        build-golang-example(revision,@code):
            container:
              image: golang:1.8
              command: |
                    cd /go/src/github.com/golang/example/hello &&
                    git status &&
                    go build -v .
        run-hello(image):
            container:
              image: $image
              command: |
                    uname -a ;
                    cat /etc/os-release ;
                    /go/src/github.com/golang/example/hello/hello
        main(revision): # 工作流入口必然是main
            steps:
              - build-golang-example($revision,$@code)
              - template: run-hello({{item.image}}:{{item.tag}})
                withItems:
                    - { image: 'debian', tag: '9.1' }
                    - { image: 'alpine', tag: '3.6' }
                    - { image: 'ubuntu', tag: '17.10' }





