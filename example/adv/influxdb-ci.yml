# argo-workflows/examples/ci.yaml
- flow(ci):
    - args:
        revision: cfe12d6
        '@code': # 共享文件(工件)
            path: /go/src/github.com/golang/example
            git:
              repo: https://github.com/golang/example.git
              revision: "{{inputs.parameters.revision}}"
    - vc_templates: # 共享的pvc, 所有任务的容器都会挂载
        workdir: # pvc名
          mount: /code # 挂载路径
          size: 1Gi # 空间大小
    - templates:
        build-golang-example(revision,@code):
            container:
              image: golang:1.8
              command: |
                    cd /go/src/github.com/golang/example/hello &&
                    git status &&
                    go build -v .
        run-hello(image):
            container:
              image: $image
              command: |
                    uname -a ;
                    cat /etc/os-release ;
                    /go/src/github.com/golang/example/hello/hello
        main(revision): # 工作流入口必然是main
            steps:
              - build-golang-example($revision)
              - template: run-hello({{item.image}}:{{item.tag}})
                withItems:
                    - { image: 'debian', tag: '9.1' }
                    - { image: 'alpine', tag: '3.6' }
                    - { image: 'ubuntu', tag: '17.10' }





